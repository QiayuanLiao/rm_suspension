# RM_Suspension User-Guidance

Rigid body dynamics simulation for suspension design of RoboMaster robots

Simulation type:

- Drop from 0.5 meter height
- Run down the stairs
- Fly the ramp
- Brake in maximum speed;
- Diagonally across the ramp

## Dependencies:
- Eigen 
- ROS (for visualization and params loading)

# Getting started 

## Install dependencies
- ROS  - http://wiki.ros.org/ROS
- Eigen - [http://eigen.tuxfamily.org](http://eigen.tuxfamily.org/)
  
NOTE: on Ubuntu 16.04 or 18.04, you may instead install Eigen with

```
sudo apt-get install libeigen3-dev -y
```
## Download and build code
1. Get the source:
```
git clone git@github.com:QiayuanLiao/rm_suspension.git
```

This is a ros_package,you should put it in your ROS workspace.

2. Download the a demo [rm_description](https://github.com/QiayuanLiao/rm_suspension/releases/download/1.0/rm_description.tar.xz) package and put it to the workspace too.
NOTE: the rm_description package is generated by Solidworks and contains a URDF file that describes the meshes, coordinate system and inertia of robot. But we only use it for visualization!!! You can run without rm_description, the whole computing process will still work correctly. 

3. Make in your workspace
```
catkin_make
source devel/setup.bash
```

## Test
Open a new terminal,then type:

```
roslaunch rm_suspension run_sim.launch
```

You will get a Rviz interface:

![8oOj4x.png](https://s1.ax1x.com/2020/03/23/8oOj4x.png)

Then,you need to open config by *Ctrl+o*

![8oj6Ts.png](https://s1.ax1x.com/2020/03/23/8oj6Ts.png)

You should select *sim.rviz* in the *rm_suspension/config* and import it, then you will see

![8TSuHe.png](https://s1.ax1x.com/2020/03/23/8TSuHe.png)

and the terminal will appear options like these,you can choose different simulation scenes according to the hint.

![8TSWE4.png](https://s1.ax1x.com/2020/03/23/8TSWE4.png)


## Analysis
1. rqt_plot
   
   There are two rqt_plot on the right of the interface, you can choose several variables of the robot and dispaly it in curve form. The two most useful variables are spring_length and the base_twist/angular. For example, you can judge whether the spring stroke is exhausted by observing the curve of the spring_length, base_twist/angular could tell you the pose of the robot. You can scale the curve by holding down the right mouse button in rqt_plot.

   ![8TCTvq.png](https://s1.ax1x.com/2020/03/23/8TCTvq.png)

2. Rvis

   On the left of the interface, you can observe the movement of the robot, which plays a significant role in flying the ramp.
   ![8TuPER.png](https://s1.ax1x.com/2020/03/23/8TuPER.png)


# Simulate your own robot
## Coordinate System
The definition of the coordinate system is shown below.
![8b9Lzd.jpg](https://s1.ax1x.com/2020/03/24/8b9Lzd.jpg)
![8bCpo8.png](https://s1.ax1x.com/2020/03/24/8bCpo8.png)
[![8bCBSH.jpg](https://s1.ax1x.com/2020/03/24/8bCBSH.jpg)](https://imgchr.com/i/8bCBSH)
NOTE: 
1. The forward direction of chassis is along the +X axis.
2. The X axis of suspension_* should parallel with the X axis of wheel_* .
3. suspe_q_offset(-0.32rad in the demo) contained by the following parameter file should be set casue by the limit of spring length.

## Parameter
In rm_suspension/config/sim_param.yaml, there are many robot parameters, you can test different effects on robot performance by changing the numerical value.
   ![8TeE8S.png](https://s1.ax1x.com/2020/03/23/8TeE8S.png)

NOTE: 
1. all parameters about suspensions or wheels are defined by suspension_0 and wheel_0.
2. the Inertia for a rigid body should be computed by Solidworks and is taken about the origin of the frame itself.
3. Every time you change a variable of the robot, you should relaunch.

## URDF
Previously mentioned, the URDF(rm_description) only for visualization. Because I can't find how to output the inertia of the rigid body correctly, and I am too lazy to write a URDF parser. You can use the [solidworks plugin](http://wiki.ros.org/sw_urdf_exporter) to export the URDF file of your robot. 